<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>One-Page Multi-Step Survey Auto-Next with Delay</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    .question {
      display: none;
      transition: opacity 0.3s ease;
    }
    .question.active {
      display: block;
      opacity: 1;
    }
    .answers label {
      display: block;
      margin-bottom: 10px;
      cursor: pointer;
      user-select: none;
    }
    input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin-right: 10px;
      vertical-align: middle;
      cursor: pointer;
    }
    #submitBtn {
      display: none;
      margin-top: 20px;
    }
    .summary {
      display: none;
    }
  </style>
</head>
<body class="bg-light py-5">

<div class="container">
  <div class="card shadow mx-auto" style="max-width: 600px;">
    <div class="card-body">

      <div class="progress mb-4">
        <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
      </div>

      <!-- Questions -->
      <div id="questionsContainer">

        <div class="question active" data-question="0">
          <h5 class="card-title">Q1: What is your favorite type of music?</h5>
          <div class="answers">
            <label><input type="checkbox" name="q0" value="Pop" onchange="selectAnswer(0, this)"> Pop</label>
            <label><input type="checkbox" name="q0" value="Rock" onchange="selectAnswer(0, this)"> Rock</label>
            <label><input type="checkbox" name="q0" value="Jazz" onchange="selectAnswer(0, this)"> Jazz</label>
            <label><input type="checkbox" name="q0" value="Classical" onchange="selectAnswer(0, this)"> Classical</label>
          </div>
        </div>

        <div class="question" data-question="1">
          <h5 class="card-title">Q2: What is your favorite color?</h5>
          <div class="answers">
            <label><input type="checkbox" name="q1" value="Red" onchange="selectAnswer(1, this)"> Red</label>
            <label><input type="checkbox" name="q1" value="Blue" onchange="selectAnswer(1, this)"> Blue</label>
            <label><input type="checkbox" name="q1" value="Green" onchange="selectAnswer(1, this)"> Green</label>
            <label><input type="checkbox" name="q1" value="Yellow" onchange="selectAnswer(1, this)"> Yellow</label>
          </div>
        </div>

        <div class="question" data-question="2">
          <h5 class="card-title">Q3: What is your favorite fruit?</h5>
          <div class="answers">
            <label><input type="checkbox" name="q2" value="Apple" onchange="selectAnswer(2, this)"> Apple</label>
            <label><input type="checkbox" name="q2" value="Banana" onchange="selectAnswer(2, this)"> Banana</label>
            <label><input type="checkbox" name="q2" value="Orange" onchange="selectAnswer(2, this)"> Orange</label>
            <label><input type="checkbox" name="q2" value="Grapes" onchange="selectAnswer(2, this)"> Grapes</label>
          </div>
        </div>

        <div class="question" data-question="3">
          <h5 class="card-title">Q4: What is your favorite season?</h5>
          <div class="answers">
            <label><input type="checkbox" name="q3" value="Spring" onchange="selectAnswer(3, this)"> Spring</label>
            <label><input type="checkbox" name="q3" value="Summer" onchange="selectAnswer(3, this)"> Summer</label>
            <label><input type="checkbox" name="q3" value="Autumn" onchange="selectAnswer(3, this)"> Autumn</label>
            <label><input type="checkbox" name="q3" value="Winter" onchange="selectAnswer(3, this)"> Winter</label>
          </div>
        </div>

      </div>

      <button id="submitBtn" class="btn btn-success" onclick="showSummary()">Submit</button>

      <div class="summary mt-4 p-3 bg-success bg-opacity-10 border border-success rounded" id="summary">
        <h5>Survey Summary</h5>
        <ul class="list-group mt-3" id="summaryList"></ul>
      </div>

    </div>
  </div>
</div>

<script>
  let currentQuestion = 0;
  const totalQuestions = document.querySelectorAll('.question').length;
  const answers = Array(totalQuestions).fill(null);
  let timeoutId = null;

  function selectAnswer(qIndex, checkbox) {
    // Cancel any pending timeout
    if (timeoutId) {
      clearTimeout(timeoutId);
      timeoutId = null;
    }

    // Uncheck other checkboxes in this question
    const checkboxes = document.querySelectorAll(`.question[data-question="${qIndex}"] input[type="checkbox"]`);
    checkboxes.forEach(cb => {
      if (cb !== checkbox) cb.checked = false;
    });

    // Save the answer or null if unchecked
    answers[qIndex] = checkbox.checked ? checkbox.value : null;

    if (checkbox.checked) {
      // If last question, show submit button after delay
      if (qIndex === totalQuestions - 1) {
        // Show the submit button after 5 seconds
        timeoutId = setTimeout(() => {
          document.getElementById('submitBtn').style.display = 'block';
        }, 500);
      } else {
        // Wait 5 seconds then move to next question
        timeoutId = setTimeout(() => {
          currentQuestion++;
          showQuestion(currentQuestion);
        }, 500);
      }
    } else {
      // If user unchecks the box before timeout, hide submit button immediately
      document.getElementById('submitBtn').style.display = 'none';
      if(timeoutId){
        clearTimeout(timeoutId);
        timeoutId = null;
      }
    }
  }

  function showQuestion(index) {
    document.querySelectorAll('.question').forEach((q, i) => {
      q.classList.toggle('active', i === index);
    });

    // Hide submit button initially on question switch
    document.getElementById('submitBtn').style.display = 'none';

    // Update checkboxes to reflect saved answers
    const selectedAnswer = answers[index];
    const checkboxes = document.querySelectorAll(`.question[data-question="${index}"] input[type="checkbox"]`);
    checkboxes.forEach(cb => {
      cb.checked = cb.value === selectedAnswer;
    });

    // Update progress bar
    const progress = ((index) / totalQuestions) * 100;
    document.getElementById('progressBar').style.width = `${progress}%`;
  }

  function showSummary() {
    // Cancel any timeout before showing summary
    if(timeoutId){
      clearTimeout(timeoutId);
      timeoutId = null;
    }
    document.getElementById('questionsContainer').style.display = 'none';
    document.getElementById('submitBtn').style.display = 'none';
    document.getElementById('progressBar').style.width = '100%';

    const summary = document.getElementById('summary');
    const list = document.getElementById('summaryList');
    list.innerHTML = answers.map((ans, i) => `<li class="list-group-item"><strong>Q${i + 1}:</strong> ${ans}</li>`).join('');
    summary.style.display = 'block';
  }

  showQuestion(currentQuestion);
</script>

</body>
</html>
